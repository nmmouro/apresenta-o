<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Painel Frota</title>
<style>
body{background:#071029;color:#fff;font-family:Arial}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.month-card{background:#2c4078;padding:12px;border-radius:10px;text-align:center}
button{margin:4px;padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
iframe{width:100%;height:500px;border:none;background:#fff}
</style>
</head>
<body>

<h2>RELATÓRIOS DE UTILIZAÇÃO</h2>
<div id="cards" class="cards"></div>
<iframe id="viewer"></iframe>

<script>
const SHEET_ID="SEU_ID_DA_PLANILHA";
const TAB_NAME="RELATÓRIO DE UTILIZAÇÃO E MANUTENÇÃO DE VEÍCULO";

const parseGviz=t=>JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
const formatCell=c=>c==null?"":(typeof c==="object"?(c.f??c.v??""):String(c));

async function fetchSheet(){
 const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(TAB_NAME)}&tqx=out:json`;
 const r=await fetch(url);
 return parseGviz(await r.text());
}

let allData=[];

function getMonthIndex(m){
 const months=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];
 return months.indexOf(m.toLowerCase());
}

function render(){
 const box=document.getElementById("cards");
 box.innerHTML="";
 allData.forEach(d=>{
  box.innerHTML+=`
   <div class="month-card">
    <b>${d.mes} ${d.ano}</b><br>
    <button onclick="openReport('${d.v1}')">V1</button>
    <button onclick="openReport('${d.v2}')">V2</button>
    <button onclick="openReport('${d.v3}')">V3</button>
    <button onclick="openReport('${d.v4}')">V4</button>
    <button onclick="openReport('${d.resumo}')">Resumo</button>
   </div>`;
 });
}

function openReport(link){
 document.getElementById("viewer").src=link;
}

async function load(){
 const g=await fetchSheet();
 const rows=(g.table.rows||[]).filter(r=>r.c&&r.c[0]);
 allData=rows.map(r=>{
  const c=r.c;
  return{
   ano:formatCell(c[0]),
   mes:formatCell(c[1]),
   v1:formatCell(c[2]),
   v2:formatCell(c[3]),
   v3:formatCell(c[4]),
   v4:formatCell(c[5]),
   resumo:formatCell(c[6]),
   mesIndex:getMonthIndex(formatCell(c[1]))
  };
 });
 allData.sort((a,b)=>b.ano-a.ano||a.mesIndex-b.mesIndex);
 render();
}
load();
</script>
</body>
</html>
