<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Relatório</title>
<style>
body{font-family:Arial}
h2{text-align:center}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #000;padding:4px;font-size:12px}
</style>
</head>
<body>

<h2 id="titulo"></h2>
<table id="tabela"></table>

<script>
const params=new URLSearchParams(location.search);
const veiculo=params.get("veiculo");
const ano=params.get("ano");
const mes=params.get("mes");

document.getElementById("titulo").innerText=`Relatório ${veiculo} - ${mes}/${ano}`;

const SHEET_ID="SEU_ID_BASE_DADOS";
const TAB_NAME="BASE";

const parseGviz=t=>JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
const formatCell=c=>c==null?"":(typeof c==="object"?(c.f??c.v??""):String(c));

async function fetchSheet(){
 const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${TAB_NAME}&tqx=out:json`;
 const r=await fetch(url);
 return parseGviz(await r.text());
}

async function load(){
 const g=await fetchSheet();
 const rows=(g.table.rows||[]);
 const data=rows.filter(r=>{
  const c=r.c||[];
  return formatCell(c[1])==veiculo && formatCell(c[0])==ano && formatCell(c[2])==mes;
 });

 const table=document.getElementById("tabela");
 table.innerHTML="<tr><th>Data</th><th>Descrição</th><th>Valor</th></tr>";
 data.forEach(r=>{
  const c=r.c;
  table.innerHTML+=`<tr><td>${formatCell(c[3])}</td><td>${formatCell(c[4])}</td><td>${formatCell(c[5])}</td></tr>`;
 });
}
load();
</script>
</body>
</html>
